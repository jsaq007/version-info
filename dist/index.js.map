{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/core.ts","../src/react.tsx"],"sourcesContent":["import type { VersionInfo, VersionConfig } from './types';\n\n/**\n * Increment version number by patch, minor, or major\n */\nexport const incrementVersion = (version: string, type: 'patch' | 'minor' | 'major' = 'patch'): string => {\n  const cleanVersion = version.startsWith('v') ? version.slice(1) : version;\n  const parts = cleanVersion.split('.').map(Number);\n\n  if (parts.length !== 3) {\n    return version;\n  }\n\n  switch (type) {\n    case 'major':\n      parts[0] += 1;\n      parts[1] = 0;\n      parts[2] = 0;\n      break;\n    case 'minor':\n      parts[1] += 1;\n      parts[2] = 0;\n      break;\n    case 'patch':\n    default:\n      parts[2] += 1;\n      break;\n  }\n\n  const prefix = version.startsWith('v') ? 'v' : '';\n  return `${prefix}${parts.join('.')}`;\n};\n\n/**\n * Get environment variables from different sources\n */\nexport const getEnvVar = (key: string): string | undefined => {\n  // Try Vite environment variables first (import.meta.env)\n  try {\n    if (typeof import.meta !== 'undefined' && import.meta.env && key in import.meta.env) {\n      const value = (import.meta.env as any)[key];\n      if (value !== undefined && value !== null) {\n        return String(value);\n      }\n    }\n  } catch {\n    // Ignore errors if import.meta is not available\n  }\n\n  // Try other possible sources for backward compatibility\n  const possibleSources = [\n    () => (globalThis as any).import?.meta?.env?.[key],\n    () => (globalThis as any).__VITE_ENV__?.[key],\n    () => (globalThis as any).VITE_ENV?.[key],\n    () => process.env?.[key],\n    () => (window as any)?.__ENV__?.[key],\n  ];\n\n  for (let i = 0; i < possibleSources.length; i++) {\n    try {\n      const value = possibleSources[i]();\n      if (value) {\n        return value;\n      }\n    } catch {\n      // Ignore errors\n    }\n  }\n\n  return undefined;\n};\n\n/**\n * Parse build time from timestamp\n */\nexport const parseBuildTime = (timestamp?: string): string | undefined => {\n  if (!timestamp) return undefined;\n\n  const time = parseInt(timestamp, 10);\n  if (isNaN(time)) return undefined;\n\n  // Handle both seconds and milliseconds\n  const date = time < 10000000000 ? new Date(time * 1000) : new Date(time);\n  return date.toISOString();\n};\n\n/**\n * Get short commit hash\n */\nexport const getShortCommitHash = (hash?: string, length: number = 7): string | undefined => {\n  return hash ? hash.slice(0, length) : undefined;\n}; ","import type { VersionInfo, VersionConfig, Environment } from './types';\nimport { incrementVersion, getEnvVar, parseBuildTime, getShortCommitHash } from './utils';\n\n/**\n * Get version information from environment variables and configuration\n */\nexport const getVersionInfo = (config?: Partial<VersionConfig>): VersionInfo => {\n  // Read from Vite environment variables with fallbacks\n  const viteVersion = config?.productionVersion || getEnvVar('VITE_VERSION');\n  const viteAppEnv = config?.environment || getEnvVar('VITE_APP_ENV') || getEnvVar('NODE_ENV') || 'development';\n  const vitePackageVersion = config?.packageVersion || getEnvVar('VITE_PACKAGE_VERSION') || getEnvVar('npm_package_version') || '0.0.0';\n  const viteCommitHash = config?.commitHash || getEnvVar('VITE_COMMIT_HASH') || getEnvVar('GITHUB_SHA');\n  const viteBuildTime = config?.buildTime || parseBuildTime(getEnvVar('VITE_BUILD_TIME'));\n\n  // Determine the environment\n  const environment = viteAppEnv || 'development';\n\n  // Determine the version (preserve v prefix if present)\n  let version = '0.0.0';\n  let productionVersion = viteVersion || 'v0.0.0';\n  let packageVersion = vitePackageVersion || '0.0.0';\n\n  // Clean production version for comparison\n  const productionVersionClean = productionVersion.startsWith('v')\n    ? productionVersion.slice(1)\n    : productionVersion;\n\n  if (environment === 'production') {\n    version = productionVersion;\n  } else {\n    if (packageVersion !== productionVersionClean) {\n      // We're ahead of production, show next version\n      version = incrementVersion(productionVersion);\n    } else {\n      // We're at the same level as production, mirror production version\n      version = productionVersion;\n    }\n  }\n\n  return {\n    version,\n    buildTime: viteBuildTime,\n    commitHash: viteCommitHash,\n    environment,\n    packageVersion: vitePackageVersion,\n  };\n};\n\n/**\n * Determine the appropriate version for each environment\n */\nconst getEnvironmentVersion = (\n  productionVersion: string,\n  packageVersion: string,\n  environment: Environment\n): string => {\n  // For production, always use the exact version from git tag\n  if (environment === 'production') {\n    return productionVersion;\n  }\n\n  // For other environments, determine if we're ahead of production\n  const productionVersionClean = productionVersion.startsWith('v')\n    ? productionVersion.slice(1)\n    : productionVersion;\n\n  // If package.json version is different from production, we're ahead\n  if (packageVersion !== productionVersionClean) {\n    // We're ahead of production, show next version\n    return incrementVersion(productionVersion);\n  } else {\n    // We're at the same level as production, mirror production version\n    return productionVersion;\n  }\n};\n\n/**\n * Format version for display with configurable options\n */\nexport const formatVersion = (\n  info: VersionInfo,\n  config?: Partial<VersionConfig>\n): string => {\n  const {\n    showEnvironment = true,\n    showCommitHash = true,\n    showBuildTime = false,\n  } = config || {};\n\n  // Only add 'v' if not already present\n  let displayText = info.version.startsWith('v') ? info.version : `v${info.version}`;\n\n  // For production, only show the version number (clean and simple)\n  if (info.environment === 'production') {\n    return displayText;\n  }\n\n  // For non-production environments, show additional info based on config\n  if (showEnvironment && info.environment && info.environment !== 'production') {\n    displayText += ` (${info.environment})`;\n  }\n\n  if (showCommitHash && info.commitHash) {\n    displayText += ` #${getShortCommitHash(info.commitHash)}`;\n  }\n\n  if (showBuildTime && info.buildTime) {\n    const date = new Date(info.buildTime);\n    displayText += ` @${date.toISOString().split('T')[0]}`;\n  }\n\n  return displayText;\n};\n\n/**\n * Create a custom version formatter\n */\nexport const createVersionFormatter = (config: Partial<VersionConfig>) => {\n  return (info: VersionInfo) => formatVersion(info, config);\n}; ","import React, { useMemo } from 'react';\nimport type { VersionInfo, VersionConfig } from './types';\nimport { getVersionInfo, formatVersion } from './core';\n\n/**\n * React hook to get version information\n */\nexport const useVersionInfo = (config?: Partial<VersionConfig>): VersionInfo => {\n  return useMemo(() => getVersionInfo(config), [\n    config?.productionVersion,\n    config?.packageVersion,\n    config?.environment,\n    config?.commitHash,\n    config?.buildTime,\n  ]);\n};\n\n/**\n * React hook to get formatted version string\n */\nexport const useVersionDisplay = (config?: Partial<VersionConfig>): string => {\n  const versionInfo = useVersionInfo(config);\n\n  return useMemo(() => formatVersion(versionInfo, config), [\n    versionInfo,\n    config?.showEnvironment,\n    config?.showCommitHash,\n    config?.showBuildTime,\n  ]);\n};\n\n/**\n * Simple React component to display version information (matches version-fix.tsx)\n */\nexport function VersionDisplay({ className = '' }: { className?: string }) {\n  const versionInfo = getVersionInfo();\n\n  return <span className={className}>{formatVersion(versionInfo)}</span>;\n}\n\n/**\n * Advanced React component to display version information with full configuration\n */\nexport interface VersionDisplayProps extends Partial<VersionConfig> {\n  className?: string;\n  children?: (version: string, info: VersionInfo) => React.ReactNode;\n}\n\nexport const VersionDisplayAdvanced: React.FC<VersionDisplayProps> = ({\n  className = '',\n  children,\n  ...config\n}) => {\n  const versionInfo = useVersionInfo(config);\n  const versionDisplay = useVersionDisplay(config);\n\n  if (children) {\n    return <>{children(versionDisplay, versionInfo)}</>;\n  }\n\n  return (\n    <span className={className} data-testid=\"version-display\">\n      {versionDisplay}\n    </span>\n  );\n}; "],"names":["incrementVersion","version","type","parts","startsWith","slice","split","map","Number","length","join","getEnvVar","key","document","require","pathToFileURL","__filename","href","_documentCurrentScript","tagName","toUpperCase","src","URL","baseURI","possibleSources","globalThis","import","meta","env","__VITE_ENV__","VITE_ENV","process","window","__ENV__","i","value","parseBuildTime","timestamp","time","parseInt","isNaN","Date","toISOString","getShortCommitHash","hash","undefined","getVersionInfo","config","viteVersion","productionVersion","viteAppEnv","environment","vitePackageVersion","packageVersion","viteCommitHash","commitHash","viteBuildTime","buildTime","productionVersionClean","formatVersion","info","showEnvironment","showCommitHash","showBuildTime","displayText","useVersionInfo","useMemo","useVersionDisplay","versionInfo","className","_jsx","jsx","children","versionDisplay","_Fragment","Fragment"],"mappings":"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"}